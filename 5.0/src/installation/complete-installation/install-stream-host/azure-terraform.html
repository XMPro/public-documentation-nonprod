<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Stream Host Azure Terraform | XMPro </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Stream Host Azure Terraform | XMPro ">
      <meta name="description" content="XMPro official documentation - Learn how to use XMPro&#39;s intelligent digital twin suite for real-time operational intelligence and automated decision-making.">
      
      <link rel="icon" href="../../../../images/favicon.png">
      <link rel="stylesheet" href="../../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../../public/main.css">
      <meta name="docfx:navrel" content="../../../../toc.html">
      <meta name="docfx:tocrel" content="../../../toc.html">
      
      <meta name="docfx:rel" content="../../../../">
      
      
      <meta name="docfx:docurl" content="https://xmpro.visualstudio.com/XMPro%20Development/_git/xmpro-development?path=docs/src/installation/complete-installation/install-stream-host/azure-terraform.md&amp;version=GBmain&amp;line=1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../../index.html">
            <img id="logo" class="svg" src="../../../../images/logo-light.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="stream-host-azure-terraform">Stream Host Azure Terraform</h1>

<h2 id="overview">Overview</h2>
<p>This guide explains how to deploy an XMPro Stream Host using the Azure Terraform module. A Stream Host is a containerized runtime that executes data streams created in Data Stream Designer (DS). You can deploy a single Stream Host or multiple Stream Hosts for horizontal scaling.</p>
<p>The Azure Terraform module uses a <strong>layered architecture</strong> that separates infrastructure from applications. This approach allows you to:</p>
<ul>
<li>Deploy a Stream Host as part of the full XMPro platform deployment</li>
<li>Deploy multiple Stream Hosts for horizontal scaling, edge processing, or regional distribution</li>
<li>Update Stream Hosts independently without affecting the underlying infrastructure</li>
</ul>
<p>This guide covers both deploying a Stream Host with the full platform and deploying additional Stream Hosts to connect to an existing DS instance.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>This section lists the requirements for deploying a Stream Host using Terraform. The requirements differ depending on whether you are deploying as part of a full platform installation or connecting to an existing DS instance.</p>
<p>Before deploying a Stream Host, ensure you have completed the <a href="../../deployment/azure-terraform/index.html#prerequisites">Azure Terraform prerequisites</a>, which cover:</p>
<ul>
<li>Terraform version 1.0 or later</li>
<li>Azure CLI setup and authentication</li>
<li>Azure subscription requirements</li>
</ul>
<h3 id="for-standalone-stream-host-deployment">For Standalone Stream Host Deployment</h3>
<p>When connecting a Stream Host to an existing DS instance rather than deploying the full platform, you need additional information from your DS administrator.</p>
<p>If you are connecting a Stream Host to an existing DS instance, you also need:</p>
<ul>
<li>The URL of your existing DS instance</li>
<li>Collection ID and Collection Secret from your DS instance (see <a href="#getting-collection-credentials">Getting Collection Credentials</a>)</li>
</ul>
<h3 id="sizing-recommendations">Sizing Recommendations</h3>
<p>The Terraform module allows you to configure Stream Host resources based on your workload:</p>
<table>
<thead>
<tr>
<th>Workload Type</th>
<th>CPU Cores</th>
<th>Memory (GB)</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>Small (Default)</td>
<td>1</td>
<td>4</td>
<td>Light data processing, few agents</td>
</tr>
<tr>
<td>Medium</td>
<td>2</td>
<td>8</td>
<td>Moderate workloads, multiple agents</td>
</tr>
<tr>
<td>Large</td>
<td>4</td>
<td>16</td>
<td>Heavy processing, complex transformations</td>
</tr>
</tbody>
</table>
<p><strong>Configuration Limits:</strong></p>
<ul>
<li>CPU: 0.25 to 4 cores</li>
<li>Memory: 0.5 to 16 GB</li>
</ul>
<div class="TIP">
<h5>Tip</h5>
<p>Start with the default configuration (1 CPU, 4 GB RAM) and scale up based on monitoring metrics.</p>
</div>
<h2 id="layered-architecture-overview">Layered Architecture Overview</h2>
<p>The XMPro Terraform module uses a <strong>layered architecture</strong> that separates infrastructure from applications:</p>
<pre><code class="lang-text">terraform-xmpro-azure/
├── _infra/                    # Infrastructure layer (deploy first)
│   └── ...                    # Resource groups, databases, storage, etc.
├── _app/                      # Application layer (deploy second)
│   └── stream-host-container/ # Stream Host module
└── examples/
    └── layered/
        ├── infra/             # Infrastructure configuration
        └── app/               # Application configuration (includes Stream Host)
</code></pre>
<p><strong>Benefits:</strong></p>
<ul>
<li><strong>Independent Lifecycles</strong>: Update a Stream Host without affecting infrastructure</li>
<li><strong>Scalable</strong>: Deploy multiple Stream Hosts easily</li>
<li><strong>Team Separation</strong>: Platform teams manage infrastructure, dev teams manage applications</li>
</ul>
<p>The following deployment options show how to use this layered architecture for different scenarios.</p>
<h2 id="deployment-options">Deployment Options</h2>
<h3 id="option-1-stream-host-with-full-xmpro-platform">Option 1: Stream Host with Full XMPro Platform</h3>
<p>When deploying the complete XMPro platform using the layered architecture, Stream Host is automatically included when <code>create_stream_host = true</code> (the default).</p>
<h4 id="step-1-deploy-infrastructure-layer">Step 1: Deploy Infrastructure Layer</h4>
<pre><code class="lang-bash">cd examples/layered/infra
cp terraform.tfvars.example terraform.tfvars
# Edit terraform.tfvars with your configuration

terraform init
terraform plan
terraform apply

# Save outputs for application layer
terraform output -json &gt; ../app/infra-outputs.json
</code></pre>
<h4 id="step-2-deploy-application-layer-includes-stream-host">Step 2: Deploy Application Layer (includes Stream Host)</h4>
<pre><code class="lang-bash">cd ../app
cp terraform.tfvars.example terraform.tfvars
# Edit terraform.tfvars using outputs from Step 1

terraform init
terraform plan
terraform apply
</code></pre>
<p>The application layer automatically:</p>
<ul>
<li>Creates a Stream Host container instance</li>
<li>Connects it to the deployed DS</li>
<li>Configures monitoring and logging</li>
</ul>
<h3 id="option-2-multiple-stream-hosts">Option 2: Multiple Stream Hosts</h3>
<p>Deploy additional Stream Host containers for horizontal scaling, edge processing, or regional deployments.</p>
<p>In your <code>app/terraform.tfvars</code>, configure the <code>stream_hosts</code> map:</p>
<pre><code class="lang-hcl"># Primary Stream Host (always created when create_stream_host = true)
create_stream_host = true

# Additional Stream Hosts
stream_hosts = {
  &quot;sh01&quot; = {
    collection_id     = &quot;your-collection-id-from-ds&quot;
    collection_secret = &quot;your-collection-secret-from-ds&quot;
    cpu               = 2
    memory            = 8
    variant           = &quot;bookworm-slim-python3.12&quot;
    environment_variables = {
      SH_PIP_MODULES = &quot;pandas numpy scikit-learn&quot;
    }
  }
  &quot;sh02&quot; = {
    collection_id     = &quot;another-collection-id&quot;
    collection_secret = &quot;another-collection-secret&quot;
    cpu               = 1
    memory            = 4
  }
}
</code></pre>
<p>Each Stream Host requires unique collection credentials from DS.</p>
<h2 id="getting-collection-credentials">Getting Collection Credentials</h2>
<p>For deployments connecting a Stream Host to an existing DS instance, you need collection credentials. Follow these steps in DS:</p>
<ol>
<li>Click on <strong>Collections</strong> in the left navigation menu</li>
<li>Select a Collection (or create a new one for this Stream Host)</li>
<li>Click the copy button next to the <strong>Id</strong> field to copy the Collection ID</li>
<li>Click the copy button next to the <strong>Key</strong> field to copy the Collection Secret</li>
</ol>
<p><img src="../../../images/image-1489.png" alt="Collection details in DS"></p>
<h2 id="key-configuration-variables">Key Configuration Variables</h2>
<p>The following tables describe the Terraform variables used to configure Stream Host deployments. These variables are set in your <code>app/terraform.tfvars</code> file.</p>
<h3 id="stream-host-variables-application-layer">Stream Host Variables (Application Layer)</h3>
<p>These variables control whether and how Stream Hosts are created:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create_stream_host</code></td>
<td>Create primary Stream Host</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>stream_hosts</code></td>
<td>Map of additional Stream Hosts</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<h3 id="per-stream-host-configuration">Per-Stream Host Configuration</h3>
<p>Each Stream Host in the <code>stream_hosts</code> map accepts the following configuration options:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cpu</code></td>
<td>CPU cores (0.25 to 4)</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>memory</code></td>
<td>Memory in GB (0.5 to 16)</td>
<td><code>4</code></td>
</tr>
<tr>
<td><code>variant</code></td>
<td>Docker image variant</td>
<td><code>&quot;&quot;</code></td>
</tr>
<tr>
<td><code>collection_id</code></td>
<td>Collection ID from DS</td>
<td>Required</td>
</tr>
<tr>
<td><code>collection_secret</code></td>
<td>Collection Secret from DS</td>
<td>Required</td>
</tr>
<tr>
<td><code>environment_variables</code></td>
<td>Custom environment variables</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<h3 id="docker-image-variants">Docker Image Variants</h3>
<p>Stream Host is available in multiple Docker image variants optimized for different use cases:</p>
<table>
<thead>
<tr>
<th>Variant</th>
<th>Description</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&quot;&quot;</code> (default)</td>
<td>Debian Bookworm slim</td>
<td>Standard deployments</td>
</tr>
<tr>
<td><code>&quot;bookworm-slim-python3.12&quot;</code></td>
<td>Debian with Python 3.12</td>
<td>Python agent support</td>
</tr>
<tr>
<td><code>&quot;alpine3.21&quot;</code></td>
<td>Alpine Linux</td>
<td>Lightweight, smaller image</td>
</tr>
</tbody>
</table>
<h2 id="configuration-examples">Configuration Examples</h2>
<p>The following examples demonstrate common Stream Host configurations for different deployment scenarios.</p>
<h3 id="python-package-installation">Python Package Installation</h3>
<p>Install Python packages for data processing (requires Python variant):</p>
<pre><code class="lang-hcl"># In your app/terraform.tfvars
stream_hosts = {
  &quot;python-sh&quot; = {
    collection_id     = &quot;your-collection-id&quot;
    collection_secret = &quot;your-collection-secret&quot;
    cpu               = 2
    memory            = 8
    variant           = &quot;bookworm-slim-python3.12&quot;
    environment_variables = {
      SH_PIP_MODULES = &quot;pandas numpy scikit-learn tensorflow&quot;
    }
  }
}
</code></pre>
<h3 id="system-dependencies">System Dependencies</h3>
<p>Install additional system packages:</p>
<pre><code class="lang-hcl">stream_hosts = {
  &quot;custom-sh&quot; = {
    collection_id     = &quot;your-collection-id&quot;
    collection_secret = &quot;your-collection-secret&quot;
    variant           = &quot;bookworm-slim-python3.12&quot;
    environment_variables = {
      ADDITIONAL_INSTALLS = &quot;git build-essential python3-dev&quot;
      SH_PIP_MODULES      = &quot;pandas numpy&quot;
    }
  }
}
</code></pre>
<div class="IMPORTANT">
<h5>Important</h5>
<p>The <code>SH_PIP_MODULES</code> environment variable only works with the <code>bookworm-slim-python3.12</code> variant. The <code>ADDITIONAL_INSTALLS</code> variable works with all variants (APT for Debian variants, APK for Alpine). See <a href="docker.html#available-variants">Docker Variants documentation</a> for details.</p>
</div>
<h3 id="horizontal-scaling">Horizontal Scaling</h3>
<p>Deploy multiple identical Stream Hosts for load distribution:</p>
<pre><code class="lang-hcl">stream_hosts = {
  &quot;sh-worker-01&quot; = {
    collection_id     = &quot;collection-1-id&quot;
    collection_secret = &quot;collection-1-secret&quot;
    cpu               = 4
    memory            = 16
  }
  &quot;sh-worker-02&quot; = {
    collection_id     = &quot;collection-2-id&quot;
    collection_secret = &quot;collection-2-secret&quot;
    cpu               = 4
    memory            = 16
  }
  &quot;sh-worker-03&quot; = {
    collection_id     = &quot;collection-3-id&quot;
    collection_secret = &quot;collection-3-secret&quot;
    cpu               = 4
    memory            = 16
  }
}
</code></pre>
<h3 id="edge-processing-lightweight">Edge Processing (Lightweight)</h3>
<p>Deploy lightweight Stream Hosts using Alpine variant:</p>
<pre><code class="lang-hcl">stream_hosts = {
  &quot;edge-sh&quot; = {
    collection_id     = &quot;edge-collection-id&quot;
    collection_secret = &quot;edge-collection-secret&quot;
    cpu               = 0.5
    memory            = 1
    variant           = &quot;alpine3.21&quot;
  }
}
</code></pre>
<h3 id="stream-host-alerting">Stream Host Alerting</h3>
<p>Enable Azure Monitor alerts for Stream Host containers:</p>
<pre><code class="lang-hcl"># In your app/terraform.tfvars
stream_host_enable_alerting       = true
stream_host_alert_email_addresses = [&quot;admin@mycompany.com&quot;, &quot;ops@mycompany.com&quot;]
stream_host_enable_cpu_alerts     = true
stream_host_cpu_alert_threshold   = 80
stream_host_enable_memory_alerts  = true
stream_host_memory_alert_threshold = 85
stream_host_enable_restart_alerts = true
stream_host_enable_stop_alerts    = true
</code></pre>
<h2 id="quick-start">Quick Start</h2>
<p>Follow these steps to deploy a Stream Host as part of the full XMPro platform using the layered architecture.</p>
<ol>
<li><p><strong>Clone the repository</strong></p>
<pre><code class="lang-bash">git clone https://github.com/XMPro/terraform-xmpro-azure.git
cd terraform-xmpro-azure/examples/layered
</code></pre>
</li>
<li><p><strong>Deploy Infrastructure</strong></p>
<pre><code class="lang-bash">cd infra
cp terraform.tfvars.example terraform.tfvars
# Edit terraform.tfvars with your values

terraform init
terraform apply
terraform output -json &gt; ../app/infra-outputs.json
</code></pre>
</li>
<li><p><strong>Deploy Applications (with Stream Host)</strong></p>
<pre><code class="lang-bash">cd ../app
cp terraform.tfvars.example terraform.tfvars
# Edit terraform.tfvars using infrastructure outputs

terraform init
terraform apply
</code></pre>
</li>
<li><p><strong>Verify Deployment</strong></p>
<pre><code class="lang-bash"># Get DS URL to verify Stream Host connection
terraform output ds_app_url

# View Stream Host container status
az container show --resource-group &lt;rg-name&gt; --name &lt;container-name&gt;
</code></pre>
</li>
</ol>
<h2 id="updating-stream-host">Updating Stream Host</h2>
<p>One of the key benefits of the layered architecture is independent application updates:</p>
<pre><code class="lang-bash">cd examples/layered/app

# Update terraform.tfvars (e.g., change imageversion or add stream hosts)
# imageversion = &quot;{{VERSION}}&quot;

terraform plan
terraform apply
</code></pre>
<p>Infrastructure remains unchanged while Stream Host is updated.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>This section covers common issues you may encounter when deploying or running Stream Hosts and how to resolve them.</p>
<h3 id="stream-host-not-connecting">Stream Host Not Connecting</h3>
<p>If the Stream Host doesn't appear in DS:</p>
<ol>
<li><p><strong>Check container logs</strong></p>
<pre><code class="lang-bash">az container logs --resource-group &lt;rg-name&gt; --name &lt;container-name&gt;
</code></pre>
</li>
<li><p><strong>Verify environment variables</strong></p>
<pre><code class="lang-bash">az container show --resource-group &lt;rg-name&gt; --name &lt;container-name&gt; \
  --query &quot;containers[0].environmentVariables&quot;
</code></pre>
</li>
<li><p><strong>Check network connectivity</strong></p>
<ul>
<li>Ensure the DS server URL is accessible</li>
<li>Verify no firewall blocking outbound connections</li>
</ul>
</li>
</ol>
<h3 id="python-package-installation-failures">Python Package Installation Failures</h3>
<p>If Python packages fail to install in your Stream Host container, check the following:</p>
<ul>
<li>Ensure you're using the <code>bookworm-slim-python3.12</code> variant</li>
<li>Check container logs for pip installation errors</li>
<li>Verify package names are correct</li>
</ul>
<h3 id="resource-allocation-issues">Resource Allocation Issues</h3>
<p>If containers fail to start or restart frequently:</p>
<ol>
<li>Check Azure Container Instances limits for your subscription</li>
<li>Review container logs for out-of-memory errors</li>
<li>Increase CPU/memory allocation in terraform.tfvars</li>
</ol>
<p>For comprehensive troubleshooting, see the <a href="../../deployment/azure-terraform/troubleshooting.html">Azure Terraform Troubleshooting Guide</a>.</p>
<h2 id="best-practices">Best Practices</h2>
<p>Follow these recommendations for successful Stream Host deployments in production environments.</p>
<ol>
<li><p><strong>Start Simple</strong></p>
<ul>
<li>Use the default configuration initially</li>
<li>Add complexity incrementally</li>
<li>Test with one Stream Host before scaling</li>
</ul>
</li>
<li><p><strong>Version Control</strong></p>
<ul>
<li>Store Terraform configurations in version control</li>
<li>Use <code>.gitignore</code> for sensitive files (terraform.tfvars with secrets)</li>
<li>Tag deployments for easy rollback</li>
</ul>
</li>
<li><p><strong>Security</strong></p>
<ul>
<li>Never commit credentials to version control</li>
<li>Use environment variables for sensitive values:
<pre><code class="lang-bash">export TF_VAR_db_admin_password=&quot;YourSecurePassword&quot;
</code></pre>
</li>
<li>Use Azure Key Vault for secrets in production</li>
</ul>
</li>
<li><p><strong>Monitoring</strong></p>
<ul>
<li>Enable Application Insights (default)</li>
<li>Configure alerting for production workloads</li>
<li>Review container logs regularly</li>
</ul>
</li>
</ol>
<h2 id="module-reference">Module Reference</h2>
<p>For complete variable reference and advanced configurations:</p>
<ul>
<li><strong><a href="https://github.com/XMPro/terraform-xmpro-azure/blob/main/README.md">Layered Architecture README</a></strong> - Complete module documentation</li>
<li><strong><a href="https://github.com/XMPro/terraform-xmpro-azure/tree/main/examples/layered/app">Application Layer Example</a></strong> - Full terraform.tfvars.example</li>
<li><strong><a href="https://github.com/XMPro/terraform-xmpro-azure/tree/main/modules/_app/stream-host-container">Stream Host Container Module</a></strong> - Module source code</li>
</ul>
<h2 id="related-documentation">Related Documentation</h2>
<p>These resources provide additional context and alternative deployment methods:</p>
<ul>
<li><a href="docker.html">Stream Host Docker Installation</a> - For standalone Docker deployments</li>
<li><a href="../../../concepts/collection.html">Collection and Stream Host Concepts</a> - Understanding Stream Host architecture</li>
<li><a href="../../deployment/azure-terraform/index.html">Azure Terraform Deployment Guide</a> - Complete platform deployment guide</li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<p>After deployment:</p>
<ol>
<li>Access DS to verify Stream Host connection</li>
<li>Create your first data stream</li>
<li>Configure agents and connectors</li>
<li>Monitor performance and adjust resources as needed</li>
</ol>


  <div class="last-modified">
    <hr />
    <p><small><em>Last modified: February 20, 2026</em></small></p>
  </div>
</article>



      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Copyright © 2025 XMPro. All rights reserved.
        </div>
      </div>
    </footer>
  </body>
</html>

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Azure | XMPro </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Azure | XMPro ">
      <meta name="description" content="XMPro official documentation - Learn how to use XMPro&#39;s intelligent digital twin suite for real-time operational intelligence and automated decision-making.">
      
      <link rel="icon" href="../../../images/favicon.png">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://xmpro.visualstudio.com/XMPro%20Development/_git/xmpro-development?path=docs/src/installation/deployment/azure.md&amp;version=GBrelease-4.4.22&amp;line=1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" class="svg" src="../../../images/logo-light.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="azure">Azure</h1>

<p>This document will guide you through how to set up the Azure infrastructure and deploy the XMPro Platform.</p>
<ul>
<li><a href="#install">Install</a></li>
<li><a href="#upgrade">Upgrade</a></li>
<li><a href="#uninstall">Uninstall</a></li>
</ul>
<h2 id="architecture">Architecture</h2>
<p>The following deployment diagram shows an example architecture and the necessary resources for the XMPro platform in Microsoft Azure.</p>
<p><img src="../../images/azure-architecture-as-of-nov-11-2024x1.png" alt="Fig 1: Example XMPro architecture in Azure"></p>
<p>Set up of Cloud Stream Host, Master Data, <a href="https://docs.microsoft.com/en-us/azure/azure-cache-for-redis/cache-dotnet-how-to-use-azure-redis-cache">Azure Cache</a>, or <a href="../install.html">Twilio</a> is optional and is dependent on client requirements. As a result, these resources will be excluded from this deployment.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>In order to proceed with the deployment, you are required to complete the steps in the <strong>1. Preparation</strong> guide:</p>
<ol>
<li>Select Azure resources that meet the <a href="../install.html"><strong>hardware</strong> requirements</a> and <a href="../install.html"><strong>software</strong> requirements</a>.</li>
<li>Follow the <a href="../install.html">certificate and communication steps</a> for an <a href="../install.html">SMTP Account</a> (Recommended).</li>
</ol>
<p>As well as having:</p>
<ul>
<li>Azure portal administrative access</li>
<li>Access to Subscription and Resource group</li>
</ul>
<h2 id="install">Install</h2>
<p>This section provides information about installing the XMPro platform from scratch in Azure.</p>
<ol>
<li>Log on to the Azure Portal <a href="https://portal.azure.com/">https://portal.azure.com/</a> (with Company Administrator access)</li>
<li>In the search bar type “Deploy” and select “Deploy a custom template”</li>
</ol>
<p><img src="../../images/azure-armtemplate-search.png" alt=""></p>
<p>3. Click &quot;Build your own template in the editor&quot;</p>
<p><img src="../../images/image-146.png" alt=""></p>
<ol start="4">
<li>Download the latest mainTemplate_[Version].json file from your XMPro account manager or support team.</li>
</ol>
<p>5. Select &quot;Load File&quot; and then Open the downloaded &quot;mainTemplate_[Version].json&quot;</p>
<p><img src="../../images/azure-armtemplate-upload.png" alt=""></p>
<p>6. Once loaded, click Save - do not change the template.</p>
<p><img src="../../images/azure-armtemplate-save.png" alt=""></p>
<p>7. Complete the form.</p>
<div class="WARNING">
<h5>Warning</h5>
<ul>
<li>Enter the username in the correct format i.e. firstname.lastname@companyname.onxmpro.com</li>
<li>The following special characters are <strong>not</strong> supported in the passwords: <code>` ' \ $ @</code></li>
<li>Take note of the passwords used as this will not be displayed again and they are required later.</li>
</ul>
</div>
<p><img src="../../images/azure-armtemplate-form.png" alt=""></p>
<p>8. Verify the information is correct and click Create.</p>
<p><img src="../../images/image-338.png" alt=""></p>
<p>After successful deployment, the following items have been installed:</p>
<ul>
<li>Subscription Manager</li>
<li>Data Stream Designer</li>
<li>App Designer</li>
<li>Stream Host</li>
</ul>
<p>Proceed to <a href="#restarting-app-services">Restart the App Services</a> after they are all deployed.</p>
<h3 id="restarting-app-services">Restarting App Services</h3>
<p>This step explains how to restart your app services in the Azure Portal.</p>
<ol>
<li>Type “Resource groups” in the search bar and select “Resource groups”.</li>
</ol>
<p><img src="../../images/azure-armtemplate-restart-1.png" alt=""></p>
<p>2. Search for the Resource Group created during installation and select it.</p>
<p><img src="../../images/azure-armtemplate-restart-2.png" alt=""></p>
<p>3. Select Subscription Manager, Data Stream Designer, and App Designer and restart the applications.</p>
<p><img src="../../images/restart-3.png" alt=""></p>
<p>4. The below GIF shows how to restart your app service.</p>
<video autoplay loop muted playsinline style="max-width: 100%; height: auto;">
  <source src="../../images/pi2gwprnfr.mp4" type="video/mp4">
</video>
<h3 id="logins">Logins</h3>
<table>
<thead>
<tr>
<th>User</th>
<th>Type</th>
<th>Password</th>
</tr>
</thead>
<tbody>
<tr>
<td>admin@xmpro.onxmpro.com</td>
<td>Super Admin</td>
<td>as entered during setup</td>
</tr>
<tr>
<td>firstname.lastname@companyname.onxmpro.com</td>
<td>Admin</td>
<td>as entered during setup</td>
</tr>
</tbody>
</table>
<h3 id="request-a-license">Request a License</h3>
<p>A new company is created as part of the installation process but needs a valid license to work.</p>
<div class="NOTE">
<h5>Note</h5>
<p>Login using the Super Admin account **admin@xmpro.onxmpro.com**.</p>
</div>
<p>1. Click Company in the left menu to open the Companies page.<br>
2. Click on the Company.<br>
3. Click on the Subscriptions gauge to open the Subscriptions page.<br>
4. Click on a Subscription.<br>
5. Click the Update License button in the command bar.<br>
6. Click <em>Generate a license request</em>, enter the number of days, and submit.<br>
7. When you have received the license from <a href="http://xmpro.com/support/">XMPro support</a>, upload it.<br>
8. Click Save.</p>
<p>This sends a request to XMPro for an App Designer license for this Company.</p>
<p><img src="../../images/image-1434.png" alt=""></p>
<div class="WARNING">
<h5>Warning</h5>
<p>The <em>Generate a license request</em> link will only work if SMTP was set up during installation.</p>
</div>
<p>9. Change the Product to Data Stream Designer from the list and request another license</p>
<div class="NOTE">
<h5>Note</h5>
<p>Licenses are given on an individual basis by the <a href="http://xmpro.com/support/">XMPro support team</a>.</p>
</div>
<p>When you have received a license for each product through an email sent to the email address given during installation, follow the steps below to upload the license for both App Designer and Data Stream Designer.</p>
<p><img src="../../images/license-3.png" alt=""></p>
<h3 id="next-step-complete-installation">Next Step: Complete Installation</h3>
<p>The installation of the XMPro Platform is now complete but before you can use the platform, some steps are needed to set up the environment. Further instructions about the configuration can be found below:</p>
<p><a href="../complete-installation/install-connectors.html">Install Connectors</a></p>
<h2 id="upgrade">Upgrade</h2>
<div class="WARNING">
<h5>Warning</h5>
<p>Before beginning the upgrade, back up databases using <a href="https://docs.microsoft.com/en-us/azure/azure-sql/database/database-export#the-azure-portal">this</a> guide.</p>
</div>
<p>Follow the same steps as a new <a href="#install">Install</a> to upgrade your XMPro platform. Make sure to:</p>
<ul>
<li>Download and use the latest &quot;mainTemplate_[Version].json&quot;.</li>
<li>Before deploying, stop the SM App Service to avoid file locking issues during MSDeploy.</li>
<li>Use the same Resource Group and credentials used during the <strong>original</strong> Install when completing the Custom deployment form.</li>
</ul>
<p><img src="../../images/azure-armtemplate-upgrade.png" alt="Azure ARM Template Upgrade"></p>
<h2 id="known-issues">Known Issues</h2>
<h3 id="notebook-upgrades-with-arm-deployments">Notebook Upgrades with ARM Deployments</h3>
<p>When upgrading XMPro instances that use AI Notebooks installed via ARM deployments, you may encounter known issues with the automated upgrade process. These issues primarily affect the Notebook components during ARM-based upgrades.</p>
<h4 id="impact-and-scope">Impact and Scope</h4>
<ul>
<li>This issue affects users who deploy via ARM and already have AI Notebooks installed</li>
<li>The issue primarily appears during upgrades to version 4.4.18 and later</li>
<li>The problem involves compatibility between the ARM template and current Azure implementation</li>
</ul>
<h4 id="workaround-manual-notebook-deployment">Workaround: Manual Notebook Deployment</h4>
<p>While automated Notebook upgrades via ARM deployments may fail, you can successfully upgrade Notebooks using the following manual deployment process:</p>
<h4 id="prerequisites-1">Prerequisites</h4>
<ol>
<li>Bash terminal</li>
<li>Azure CLI 2</li>
<li>Helm 3.X</li>
</ol>
<h4 id="manual-deployment-steps">Manual Deployment Steps</h4>
<ol>
<li><strong>Login and validate connection to the correct subscription</strong></li>
</ol>
<pre><code class="lang-bash">az login
az account show
</code></pre>
<ol start="2">
<li><strong>Find the name of the AKS resource</strong></li>
</ol>
<pre><code class="lang-bash">az aks list -o table
</code></pre>
<ol start="3">
<li><strong>Merge the AKS cluster into kubeconfig</strong></li>
</ol>
<pre><code class="lang-bash">az aks get-credentials -n &lt;aks resource name&gt; -g &lt;resource group&gt;
</code></pre>
<ol start="4">
<li><strong>Check the kubectl is connected to the AKS instance</strong></li>
</ol>
<pre><code class="lang-bash">kubectl config current-context
</code></pre>
<ol start="5">
<li><strong>Find the helm deployment</strong></li>
</ol>
<pre><code class="lang-bash">helm list -n prod
</code></pre>
<ol start="6">
<li><strong>Check the helm deployment values and save to values.yml</strong></li>
</ol>
<pre><code class="lang-bash">helm get values xmpro-notebooks -n prod &gt; values.yml | sed -i '1d' values.yml
</code></pre>
<ol start="7">
<li><strong>Remove the first line &quot;USER-SUPPLIED VALUES:&quot;</strong></li>
</ol>
<pre><code class="lang-bash">sed -i '1d' values.yml
</code></pre>
<ol start="8">
<li><strong>Observe the singleuser section in values.yml</strong></li>
</ol>
<pre><code class="lang-yaml">singleuser:
  image:
    name: &lt;registry&gt;/base-jupyter-notebook
    tag: &lt;release-version&gt;
</code></pre>
<ol start="9">
<li><strong>Set the following values</strong></li>
</ol>
<ul>
<li><code>&lt;registry&gt;</code> = xmpro.azurecr.io</li>
<li><code>&lt;release-version&gt;</code> = the desired release tag version e.g. 4.4.18</li>
</ul>
<ol start="10">
<li><strong>Deploy the values upgrade using Helm</strong></li>
</ol>
<pre><code class="lang-bash">helm upgrade --cleanup-on-fail --install xmpro-notebooks jupyterhub/jupyterhub --namespace prod --create-namespace
</code></pre>
<ol start="11">
<li><strong>Wait for the deployment to complete</strong></li>
<li><strong>Verify the deployment</strong></li>
</ol>
<pre><code class="lang-bash">helm list -n prod
</code></pre>
<ol start="13">
<li><strong>Verify the values are set correctly</strong></li>
</ol>
<pre><code class="lang-bash">helm get values xmpro-notebooks -n prod
</code></pre>
<ol start="14">
<li><strong>Verify the pods status</strong></li>
</ol>
<pre><code class="lang-bash">kubectl get pods -n prod
</code></pre>
<ol start="15">
<li><strong>If required, forcefully restart the notebook pods</strong></li>
</ol>
<pre><code class="lang-bash">kubectl delete pods --all -n prod
</code></pre>
<h3 id="issues">Issues</h3>
<h3 id="1-notebook-urls-are-mismatched">1. Notebook URLs are mismatched</h3>
<p>The URLs for notebook should be in sync in all the places:</p>
<ul>
<li>AI AppService &gt; Environment Vars &gt; xmpro:aidesigner:jupyterUrl</li>
<li>SM DB dbo.ProductUrls &gt; Notebook Url</li>
<li>Helm Chart Release &gt; xmpro-notebook &gt; values</li>
<li><code>kubectl describe svc proxy-public -n prod</code> &gt; annotations &gt; service.beta.kubernetes.io/azure-dns-label-name</li>
</ul>
<h4 id="troubleshooting-">Troubleshooting <a href="#user-content-troubleshooting" id="user-content-troubleshooting"></a></h4>
<pre><code class="lang-bash"># az login to the subscription
az login
</code></pre>
<p><strong>Connect to the aks instance</strong></p>
<pre><code class="lang-bash">az aks list -o table
az aks get-credentials -g &lt;resource-group&gt; -n &lt;aks-instance-name-from-above&gt;
kubectl config set-context &lt;aks-instance-name-from-above&gt;
kubectl config current-context
</code></pre>
<p><strong>Get helm deployment details</strong></p>
<pre><code class="lang-bash">helm ls -n prod
helm get values xmpro-notebooks -n prod
// check the notebook URLs
</code></pre>
<p><strong>Get proxy public annotations</strong></p>
<pre><code class="lang-bash">kubectl get svc -n prod
kubectl describe svc proxy-public -n prod
// check the service.beta.kubernetes.io/azure-dns-label-name annotation
</code></pre>
<p><strong>Check the SQL database</strong></p>
<pre><code class="lang-bash">az resource list -g &lt;resource-group&gt; -o table
az sql server show -g &lt;resource-group&gt; -n &lt;sql-server-instance-name-from-above&gt;
# check the SM DB dbo.ProductUrls &gt; Notebook Url
</code></pre>
<p><strong>Force restart all pods</strong></p>
<pre><code class="lang-bash">kubectl get pods -n prod
kubectl delete pods --all -n prod
</code></pre>
<h3 id="2-access-denied-to-storage-account">2. Access Denied to Storage Account</h3>
<p>After a Notebook upgrade, launching a Jupyter Hub user instance may result in an error such as:</p>
<pre><code>MountVolume.MountDevice failed for volume &quot;pvc-64bd7714-7c0e-45ca-88cc-c1bdf816108e&quot;: rpc error: code = Internal desc = volume(MC_armupgrade_aks-armup-xmpro-001_centralus#nfs0f17de3935cc49c2ae46#pvc-64bd7714-7c0e-45ca-88cc-c1bdf816108e##prod#) mount &quot;nfs0f17de3935cc49c2ae46.blob.core.windows.net:/nfs0f17de3935cc49c2ae46/pvc-64bd7714-7c0e-45ca-88cc-c1bdf816108e&quot; on &quot;/var/lib/kubelet/plugins/kubernetes.io/csi/blob.csi.azure.com/fd5793275cbf92e1d702e30d03bcf1634564e3690e3b635a763e814f5e09c29/globalmount&quot; failed with mount failed: exit status 1 Mounting command: mount Mounting arguments: -t aznfs -o nconnect=4,sec=sys,vers=3,nolock nfs0f17de3935cc49c2ae46.blob.core.windows.net:/nfs0f17de3935cc49c2ae46/pvc-64bd7714-7c0e-45ca-88cc-c1bdf816108e /var/lib/kubelet/plugins/kubernetes.io/csi/blob.csi.azure.com/fd5793275cbf92e1d702e30d03bcf1634564e3690e3b635a763e814f5e09c29/globalmount Output: [0mmount.nfs: access denied by server while mounting 10.161.100.100:/nfs0f17de3935cc49c2ae46/pvc-64bd7714-7c0e-45ca-88cc-c1bdf816108e[0m [2;31mMount failed![0[0m Please refer to http://aka.ms/blobmounterror for possible causes and solutions for mount errors.
</code></pre>
<p>Follow the appropriate instructions on the link <a href="http://aka.ms/blobmounterror">http://aka.ms/blobmounterror</a>  to fix up the reported error.</p>
<p>These particular steps deal with the <a href="https://learn.microsoft.com/en-us/troubleshoot/azure/azure-kubernetes/storage/mounting-azure-blob-storage-container-fail#nfs-error2">Access denied by the server</a> error.</p>
<h2 id="uninstall">Uninstall</h2>
<p>This section provides information about uninstalling the XMPro platform from Azure.</p>
<ol>
<li>Open the resource group where XMPro is installed</li>
<li>Click Delete resource group</li>
</ol>
<p><img src="../../images/delete-1.png" alt=""></p>
<p>3. Enter the name of the resource group and click <em>Delete</em></p>
<p><img src="../../images/azure-armtemplate-delete.png" alt=""></p>


  <div class="last-modified">
    <hr />
    <p><small><em>Last modified: July 15, 2025</em></small></p>
  </div>
</article>



      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Copyright © 2025 XMPro. All rights reserved.
        </div>
      </div>
    </footer>
  </body>
</html>
